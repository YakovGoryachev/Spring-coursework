<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ru">
<head>
<!--  <link rel="stylesheet" th:href="@{/static/css/all-tracks-style.css}"> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<div th:fragment="content">
  <h1 class="page-title">
    <i class="fas fa-music"></i>
    Все треки
  </h1>


  <form th:action="@{/allTracks}" method="get" class="search-form">
    <div class="search-section">
      <div class="search-bar">
        <div class="search-wrapper">
          <div class="search-category">
            <select name="searchCategory" class="category-select custom-select" >
              <option value="">Все категории</option>
              <option value="title" th:selected="${searchCategory == 'title'}">Название трека</option>
              <option value="artist" th:selected="${searchCategory == 'artist'}">Артист</option>
              <option value="album" th:selected="${searchCategory == 'album'}">Альбом</option>
              <option value="genre" th:selected="${searchCategory == 'genre'}">Жанр</option>
              <option value="group" th:selected="${searchCategory == 'group'}">Группа</option>
<!--              <option value="year" th:selected="${searchCategory == 'year'}">Год</option>-->
            </select>
          </div>

          <i class="fas fa-search"></i>
          <input type="text"
                 name="search"
                 placeholder="Поиск..."
                 th:value="${search ?: ''}"
                 class="search-input">

          <button type="submit" class="search-btn">
            <i class="fas fa-search"></i> Найти
          </button>

          <a th:href="@{/allTracks}" class="reset-btn" title="Сбросить фильтры">
            <i class="fas fa-redo"></i> Сбросить
          </a>
        </div>
      </div>
    </div>
  </form>

  <div class="content-container">
<!--    <div th:if="${contentType == 'tracks' or contentType == null}">-->
    <div th:if="${tracks != null}">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-headphones"></i>
          Все треки
          <span class="count-badge" th:text="${totalElements} + ' треков'"></span>
        </h2>
      </div>

      <div class="table-container">
        <table class="chart-table">
          <thead>
          <tr>
<!--            <th>Id</th>-->
            <th>Трек</th>
            <th>Артист</th>
            <th>Альбом</th>
            <th>Группа</th>
            <th>Жанр</th>
            <th><i class="far fa-clock"></i></th>
            <th>Прослушиваний</th>
            <th>Действия</th>
          </tr>
          </thead>
          <tbody th:if="${tracks.size() > 0}" id="chart-table" class="table-hover">
          <tr th:each="track : ${tracks}" class="track-row">
<!--            <td th:text="${track.id}"></td>-->
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 40px; height: 40px; border-radius: 5px; overflow: hidden; background: rgba(255,255,255,0.1);">
                  <img th:src="@{${track.avatarPath} != null ? ${track.avatarPath} : 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=400&fit=crop'}"
                       alt="Обложка" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <a class="a-row" th:text="${track.name}" th:href="@{'/details/track/' + ${track.id}}"></a>
              </div>
<!--              <a class="a-row" th:text="${track.name}" th:href="@{'/details/track' + ${track.id}}"></a>-->
            </td>
            <td><a class="a-row" th:if="${track.artistId > 0}" th:text="${track.artistName}" th:href="@{'/details/artist/' + ${track.artistId}}"></a><span th:if="${track.artistId == 0 || track.artistName == null}" th:text="${track.artistName}"></span></td>
            <td><a class="a-row" th:if="${track.albumId > 0}" th:text="${track.albumName}" th:href="@{'/details/album/' + ${track.albumId}}"></a><span th:if="${track.albumId == 0 || track.albumName == null}" th:text="${track.albumName}"></span></td>
            <td><a class="a-row" th:if="${track.groupId > 0}" th:text="${track.groupName}" th:href="@{'/details/group/' + ${track.groupId}}"></a><span th:if="${track.groupId == 0 || track.groupName == null}" th:text="${track.groupName}"></span></td>
            <td th:text="${track.genre}"></td>
            <td th:text="${track.getFormattedDuration}"></td>
            <td th:text="${track.playCount}"></td>
            <td sec:authorize="isAuthenticated()">
              <form th:action="@{'/tracks/' + ${track.id} + '/add-to-playlist'}" method="post" style="display: inline;">
                <input type="text" name="playlistName" placeholder="Название плейлиста" required
                       style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 5px 10px; border-radius: 5px; margin-right: 5px; width: 150px;">
                <input type="hidden" name="returnUrl" th:value="@{/allTracks(page=${currentPage}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}">
                <button type="submit" class="btn" style="padding: 5px 15px;">
                  <i class="fa fa-plus"></i> Добавить
                </button>
              </form>
              <button class="play-track-btn"
                      th:data-track-id="${track.id}"
                      th:data-title="${track.name}"
                      th:data-artist="${track.artistName}">
                <i class="fas fa-play"></i>
              </button>
            </td>
            <td sec:authorize="!isAuthenticated()">
              <a class="btn" th:href="@{/login}"><i class="fa fa-lock"></i> Войдите для добавления</a>
              <button class="play-track-btn"
                      th:data-track-id="${track.id}"
                      th:data-title="${track.name}"
                      th:data-artist="${track.artistName}">
                <i class="fas fa-play"></i>
              </button>
            </td>
          </tr>

          </tbody>
          <tr th:if="${#lists.isEmpty(tracks)}">
            <td colspan="8" style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; color: rgba(255,255,255,0.1); margin-bottom: 20px;">
                <i class="fas fa-music"></i>
              </div>
              <h3 style="color: #aaa; margin-bottom: 10px;">Треков не найдено</h3>
              <p style="color: #666; margin-bottom: 20px;">
                Попробуйте изменить параметры поиска
              </p>
              <a th:href="@{/allTracks}" class="btn btn-primary">
                <i class="fas fa-redo"></i>
                Показать все треки
              </a>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <th:block th:inline="javascript">
      <script>
        window.addEventListener('load', () => {
            const tracksFromServer = /*[[${tracks}]]*/ [];
            if (tracksFromServer.length > 0) {
                if (window.updateTrackList) {
                    window.updateTrackList(tracksFromServer);
                } else {
                    console.error('updateTrackList is not available');
                }
            }
        });
      </script>
    </th:block>

    <div th:if="${artists != null}">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-user"></i>
          Исполнители
          <span class="count-badge" th:text="${totalElements} + ' артистов'"></span>
        </h2>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th>Id</th>
            <th>Исполнитель</th>
<!--            <th>Действия</th>-->
          </tr>
          </thead>
          <tbody>
          <tr th:each="artist, iter : ${artists}" th:class="${iter.odd} ? 'odd-row' : 'even-row'">
            <td th:text="${artist.id}"></td>
            <td><a class="a-row" th:text="${artist.name}" th:href="@{'/details/artist/' + ${artist.id}}"></a></td>
<!--            <td class="artist-cell">-->
<!--              <div class="artist-info-small">-->
<!--                <img th:src="${artist.avatarUrl ?: '/static/images/default-avatar.jpg'}"-->
<!--                     alt="[[${artist.name}]]"-->
<!--                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">-->
<!--                <div style="margin-left: 12px;">-->
<!--                  <div class="artist-name">[[${artist.name}]]</div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </td>-->

<!--            <td>-->
<!--              <div class="track-actions">-->
<!--                <a th:href="@{/artists/{id}(id=${artist.id})}"-->
<!--                   class="action-btn" title="Перейти к артисту">-->
<!--                  <i class="fas fa-eye"></i>-->
<!--                </a>-->
<!--              </div>-->
<!--            </td>-->
          </tr>
          </tbody>

          <tr th:if="${#lists.isEmpty(artists)}">
            <td colspan="8" style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; color: rgba(255,255,255,0.1); margin-bottom: 20px;">
                <i class="fas fa-music"></i>
              </div>
              <h3 style="color: #aaa; margin-bottom: 10px;">Артисты не найдены</h3>
              <p style="color: #666; margin-bottom: 20px;">
                Попробуйте изменить параметры поиска
              </p>
              <a th:href="@{/allTracks}" class="btn btn-primary">
                <i class="fas fa-redo"></i>
                Показать все треки
              </a>
            </td>
          </tr>

        </table>
      </div>
    </div>

    <div th:if="${albums != null}">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-compact-disc"></i>
          Альбомы
          <span class="count-badge" th:text="${totalElements} + ' альбомов'"></span>
        </h2>
      </div>

      <div class="table-container">
        <table class="chart-table">
          <thead>
          <tr>
            <th>Id</th>
            <!--                        <th>Обложка</th>-->
            <th>Название</th>
            <th>Группа</th>
<!--            <th>Дата выпуска</th>-->
            <th>Прослушиваний</th>
          </tr>
          </thead>
          <tbody th:if="${albums.size() > 0}" class="table-hover">
          <tr th:each="album : ${albums}" class="track-row">
            <td th:text="${album.id}"></td>
            <td><a class="a-row" th:text="${album.name}" th:href="@{'/details/album/' + ${album.id}}"></a></td>
            <td><a class="a-row" th:if="${album.groupId > 0}" th:text="${album.groupName}" th:href="@{'/details/group/' + ${album.groupId}}"></a><span th:if="${album.groupId == 0 || album.groupName == null}" th:text="${album.groupName}"></span></td>
            <td th:text="${album.playCount}"></td>
          </tr>

          </tbody>
          <tr th:if="${#lists.isEmpty(albums)}">
            <td colspan="8" style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; color: rgba(255,255,255,0.1); margin-bottom: 20px;">
                <i class="fas fa-music"></i>
              </div>
              <h3 style="color: #aaa; margin-bottom: 10px;">Альбомов не найдено</h3>
              <p style="color: #666; margin-bottom: 20px;">
                Попробуйте изменить параметры поиска
              </p>
              <a th:href="@{/allTracks}" class="btn btn-primary">
                <i class="fas fa-redo"></i>
                Показать все треки
              </a>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div th:if="${totalPages > 1}" style="margin-top: 30px; display: flex; justify-content: center; align-items: center; gap: 15px;">
      <a th:href="@{/allTracks(page=${currentPage > 1 ? currentPage - 1 : 1}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
         th:classappend="${currentPage == 1} ? 'disabled' : ''"
         style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; display: flex; align-items: center; gap: 5px;">
        <i class="fas fa-chevron-left"></i> Назад
      </a>

      <div style="display: flex; gap: 5px;">
        <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
          <a th:href="@{/allTracks(page=${i}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
             th:style="${currentPage == i} ? 'background: #4ecdc4; color: white;' : 'background: rgba(255,255,255,0.1); color: white;'"
             style="width: 35px; height: 35px; border: none; border-radius: 5px; display: flex; align-items: center; justify-content: center; text-decoration: none; font-weight: bold;"
             th:text="${i}">1</a>
        </th:block>
      </div>

      <a th:href="@{/allTracks(page=${currentPage < totalPages ? currentPage + 1 : totalPages}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
         th:classappend="${currentPage == totalPages} ? 'disabled' : ''"
         style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; display: flex; align-items: center; gap: 5px;">
        Вперед <i class="fas fa-chevron-right"></i>
      </a>

      <div style="margin-left: 20px; color: #aaa;">
        <span>Показывать по: </span>
        <form th:action="@{/allTracks}" method="get" style="display: inline;">
          <input type="hidden" name="search" th:value="${search}">
          <input type="hidden" name="searchCategory" th:value="${searchCategory}">
          <select name="size" onchange="this.form.submit()" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 5px 10px; border-radius: 5px; margin-left: 5px;">
            <option value="10" th:selected="${pageSize == 10}">10</option>
            <option value="20" th:selected="${pageSize == 20}">20</option>
            <option value="50" th:selected="${pageSize == 50}">50</option>
            <option value="100" th:selected="${pageSize == 100}">100</option>
          </select>
        </form>
      </div>
    </div>


    </div>
  </div>
</html>