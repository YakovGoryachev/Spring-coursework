<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
<!--  <link rel="stylesheet" th:href="@{/static/css/all-tracks-style.css}"> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<div th:fragment="content">
  <h1 class="page-title">
    <i class="fas fa-music"></i>
    Все треки
  </h1>

  <!-- Панель поиска с фильтром -->
  <form th:action="@{/allTracks}" method="get" class="search-form">
    <div class="search-section">
      <div class="search-bar">
        <div class="search-wrapper">
          <!-- Селект категории поиска -->
          <div class="search-category">
            <select name="searchCategory" class="category-select custom-select" >
              <option value="">Все категории</option>
              <option value="title" th:selected="${searchCategory == 'title'}">Название трека</option>
              <option value="artist" th:selected="${searchCategory == 'artist'}">Исполнитель</option>
              <option value="album" th:selected="${searchCategory == 'album'}">Альбом</option>
              <option value="genre" th:selected="${searchCategory == 'genre'}">Жанр</option>
              <option value="year" th:selected="${searchCategory == 'year'}">Год</option>
            </select>
          </div>

          <!-- Поле поиска -->
          <i class="fas fa-search"></i>
          <input type="text"
                 name="search"
                 placeholder="Поиск..."
                 th:value="${search ?: ''}"
                 class="search-input">

          <!-- Кнопка поиска -->
          <button type="submit" class="search-btn">
            <i class="fas fa-search"></i> Найти
          </button>

          <!-- Кнопка сброса -->
          <a th:href="@{/allTracks}" class="reset-btn" title="Сбросить фильтры">
            <i class="fas fa-redo"></i> Сбросить
          </a>
        </div>
      </div>
    </div>
  </form>

  <!-- Контейнер для контента -->
  <div class="content-container">
    <!-- === ТРЕКИ === -->
    <div th:if="${contentType == 'tracks' or contentType == null}">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-headphones"></i>
          Все треки
          <span class="count-badge" th:text="${totalElements} + ' треков'"></span>
        </h2>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th style="width: 50px;">#</th>
            <th>Трек</th>
            <th>Артист</th>
            <th>Альбом</th>
            <th><i class="fas fa-clock"></i></th>
            <th>Жанр</th>
            <th>Год</th>
            <th style="width: 150px;">Действия</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="track, iter : ${tracks}" th:class="${iter.odd} ? 'odd-row' : 'even-row'">
            <td th:text="${iter.index + 1 + ((currentPage - 1) * pageSize)}"></td>
            <td class="track-cell">
              <div class="track-info-small">
                <img th:src="${track.coverUrl ?: '/static/images/default-track.jpg'}"
                     alt="Обложка трека">
                <div>
                  <div class="track-name">[[${track.title}]]</div>
                  <div class="track-details">
                    <span th:text="${track.bitrate} ? ${track.bitrate + ' kbps'} : '320 kbps'"></span>
                    •
                    <span th:text="${track.format ?: 'MP3'}"></span>
                  </div>
                </div>
              </div>
            </td>
            <td>
              <a th:href="@{/artists/{id}(id=${track.artistId})}"
                 style="color: white; text-decoration: none;">
                [[${track.artistName}]]
              </a>
            </td>
            <td>
              <a th:href="@{/albums/{id}(id=${track.albumId})}"
                 th:if="${track.albumId}"
                 style="color: #aaa; text-decoration: none;">
                [[${track.albumName}]]
              </a>
              <span th:unless="${track.albumId}" style="color: #666;">Без альбома</span>
            </td>
            <td style="color: #aaa;">[[${#temporals.format(track.duration, 'mm:ss')}]]</td>
            <td>
              <span class="genre-tag" th:text="${track.genre}"></span>
            </td>
            <td style="color: #aaa;">[[${track.year}]]</td>
            <td>
              <div class="track-actions">
                <button class="action-btn" title="Воспроизвести"
                        th:onclick="'playTrack(' + ${track.id} + ')'">
                  <i class="fas fa-play"></i>
                </button>
                <button class="action-btn favorite" title="Добавить в избранное">
                  <i class="fas fa-heart"></i>
                </button>
                <a th:href="@{/tracks/{id}(id=${track.id})}"
                   class="action-btn" title="Подробнее">
                  <i class="fas fa-info-circle"></i>
                </a>
              </div>
            </td>
          </tr>

          <!-- Если треков нет -->
          <tr th:if="${#lists.isEmpty(tracks)}">
            <td colspan="8" style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; color: rgba(255,255,255,0.1); margin-bottom: 20px;">
                <i class="fas fa-music"></i>
              </div>
              <h3 style="color: #aaa; margin-bottom: 10px;">Треков не найдено</h3>
              <p style="color: #666; margin-bottom: 20px;">
                Попробуйте изменить параметры поиска
              </p>
              <a th:href="@{/allTracks}" class="btn btn-primary">
                <i class="fas fa-redo"></i>
                Показать все треки
              </a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- === АРТИСТЫ === -->
    <div th:if="${contentType == 'artists'}">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-user"></i>
          Исполнители
          <span class="count-badge" th:text="${totalElements} + ' артистов'"></span>
        </h2>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th style="width: 50px;">#</th>
            <th>Исполнитель</th>
            <th>Жанры</th>
            <th>Кол-во треков</th>
            <th>Кол-во альбомов</th>
            <th>Действия</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="artist, iter : ${artists}" th:class="${iter.odd} ? 'odd-row' : 'even-row'">
            <td th:text="${iter.index + 1 + ((currentPage - 1) * pageSize)}"></td>
            <td class="artist-cell">
              <div class="artist-info-small">
                <img th:src="${artist.avatarUrl ?: '/static/images/default-avatar.jpg'}"
                     alt="[[${artist.name}]]"
                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                <div style="margin-left: 12px;">
                  <div class="artist-name">[[${artist.name}]]</div>
                </div>
              </div>
            </td>
            <td>
              <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                <span class="genre-tag" th:each="genre : ${artist.genres}"
                      th:text="${genre}"></span>
              </div>
            </td>
            <td style="color: #4ecdc4; font-weight: 500;">[[${artist.trackCount}]]</td>
            <td style="color: #aaa;">[[${artist.albumCount}]]</td>
            <td>
              <div class="track-actions">
                <a th:href="@{/artists/{id}(id=${artist.id})}"
                   class="action-btn" title="Перейти к артисту">
                  <i class="fas fa-eye"></i>
                </a>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- === АЛЬБОМЫ === -->
    <div th:if="${contentType == 'albums'}">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-compact-disc"></i>
          Альбомы
          <span class="count-badge" th:text="${totalElements} + ' альбомов'"></span>
        </h2>
      </div>

      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th style="width: 50px;">#</th>
            <th>Альбом</th>
            <th>Исполнитель</th>
            <th>Год</th>
            <th>Кол-во треков</th>
            <th>Длительность</th>
            <th>Действия</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="album, iter : ${albums}" th:class="${iter.odd} ? 'odd-row' : 'even-row'">
            <td th:text="${iter.index + 1 + ((currentPage - 1) * pageSize)}"></td>
            <td class="album-cell">
              <div class="album-info-small">
                <img th:src="${album.coverUrl ?: '/static/images/default-album.jpg'}"
                     alt="[[${album.title}]]"
                     style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover;">
                <div style="margin-left: 12px;">
                  <div class="album-title">[[${album.title}]]</div>
                </div>
              </div>
            </td>
            <td>
              <a th:href="@{/artists/{id}(id=${album.artistId})}"
                 style="color: white; text-decoration: none;">
                [[${album.artistName}]]
              </a>
            </td>
            <td style="color: #aaa;">[[${album.year}]]</td>
            <td style="color: #4ecdc4; font-weight: 500;">[[${album.trackCount}]]</td>
            <td style="color: #aaa;">[[${#temporals.format(album.totalDuration, 'HH:mm')}]]</td>
            <td>
              <div class="track-actions">
                <a th:href="@{/albums/{id}(id=${album.id})}"
                   class="action-btn" title="Перейти к альбому">
                  <i class="fas fa-eye"></i>
                </a>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Пагинация -->
  <div th:if="${totalPages > 1}" class="pagination-section">
    <div class="pagination-info">
      Показано:
      <span>[[${(currentPage - 1) * pageSize + 1}]]-[[${math.min(currentPage * pageSize, totalElements)}]]</span>
      из <span>[[${totalElements}]]</span>
    </div>

    <div class="pagination">
      <!-- Кнопка "Назад" -->
      <a th:href="@{/allTracks(contentType=${contentType}, page=${currentPage > 1 ? currentPage - 1 : 1}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
         th:classappend="${currentPage == 1} ? 'disabled' : ''"
         class="pagination-btn">
        <i class="fas fa-chevron-left"></i> Назад
      </a>

      <!-- Номера страниц -->
      <div class="page-numbers">
        <!-- Первая страница -->
        <a th:href="@{/allTracks(contentType=${contentType}, page=1, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
           th:classappend="${currentPage == 1} ? 'active page-btn' : 'page-btn'">
          1
        </a>

        <!-- Многоточие если нужно -->
        <span th:if="${currentPage > 3}" class="page-dots">...</span>

        <!-- Страницы вокруг текущей -->
        <th:block th:each="i : ${#numbers.sequence(math.max(2, currentPage - 1), math.min(totalPages - 1, currentPage + 1))}">
          <a th:href="@{/allTracks(contentType=${contentType}, page=${i}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
             th:classappend="${currentPage == i} ? 'active page-btn' : 'page-btn'">
            [[${i}]]
          </a>
        </th:block>

        <!-- Многоточие если нужно -->
        <span th:if="${currentPage < totalPages - 2}" class="page-dots">...</span>

        <!-- Последняя страница если не первая -->
        <a th:if="${totalPages > 1}"
           th:href="@{/allTracks(contentType=${contentType}, page=${totalPages}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
           th:classappend="${currentPage == totalPages} ? 'active page-btn' : 'page-btn'">
          [[${totalPages}]]
        </a>
      </div>

      <!-- Кнопка "Вперед" -->
      <a th:href="@{/allTracks(contentType=${contentType}, page=${currentPage < totalPages ? currentPage + 1 : totalPages}, size=${pageSize}, search=${search}, searchCategory=${searchCategory})}"
         th:classappend="${currentPage == totalPages} ? 'disabled' : ''"
         class="pagination-btn">
        Вперед <i class="fas fa-chevron-right"></i>
      </a>

      <!-- Выбор размера страницы -->
      <div class="page-size-selector">
        <span>На странице:</span>
        <form th:action="@{/allTracks}" method="get" style="display: inline;">
          <input type="hidden" name="contentType" th:value="${contentType}">
          <input type="hidden" name="search" th:value="${search}">
          <input type="hidden" name="searchCategory" th:value="${searchCategory}">
          <select name="size" class="form-input small" onchange="this.form.submit()">
            <option value="10" th:selected="${pageSize == 10}">10</option>
            <option value="20" th:selected="${pageSize == 20}">20</option>
            <option value="50" th:selected="${pageSize == 50}">50</option>
            <option value="100" th:selected="${pageSize == 100}">100</option>
          </select>
        </form>
      </div>
    </div>
  </div>

  <!-- Стили -->
  <style>
  </style>
</div>
</html>