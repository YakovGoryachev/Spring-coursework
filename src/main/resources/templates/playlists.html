<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Плейлисты - MusicStream</title>
  <link rel="stylesheet" th:href="@{/static/css/style-uni.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="container">

  <div class="main-content" th:fragment="content">

    <!-- Заголовок и кнопка создания -->
    <div class="section" style="padding-bottom: 15px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 class="section-title">
          <i class="fas fa-list"></i>
          Мои плейлисты
        </h2>
        <a th:href="@{/playlists/new}" class="btn btn-primary">
          <i class="fas fa-plus"></i>
          Создать плейлист
        </a>
      </div>
      <p style="color: #aaa; margin-top: 10px; font-size: 14px;">
        Здесь вы можете управлять своими плейлистами
      </p>
    </div>

    <!-- Поиск плейлистов -->
    <div class="search-section">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <form th:action="@{/playlists}" method="get" style="display: flex; width: 100%;">
          <input type="text" name="search" placeholder="Поиск плейлистов по названию..."
                 th:value="${searchQuery ?: ''}"
                 style="flex: 1; background: transparent; border: none; color: white; font-size: 14px; padding: 10px 0; outline: none;">
          <button type="submit" class="search-btn">
            <i class="fas fa-search"></i> Найти
          </button>
        </form>
      </div>

      <!-- Фильтры (опционально) -->
      <div class="search-filters">
        <a th:href="@{/playlists}"
           th:classappend="${#strings.isEmpty(searchQuery) ? 'active' : ''}"
           class="filter-btn" style="text-decoration: none">
          Все плейлисты
        </a>
        <a th:href="@{/playlists(sort='date')}"
           th:classappend="${sort == 'date' ? 'active' : ''}"
           class="filter-btn" style="text-decoration: none">
          По дате
        </a>
        <a th:href="@{/playlists(sort='name')}"
           th:classappend="${sort == 'name' ? 'active' : ''}"
           class="filter-btn" style="text-decoration: none">
          По названию
        </a>
      </div>
    </div>

    <!-- Список плейлистов -->
    <div class="section">
      <div class="table-container">
        <table class="table">
          <thead>
          <tr>
            <th style="width: 50px;"></th>
            <th>Название плейлиста</th>
            <th style="width: 150px;">Треков</th>
            <th style="width: 150px;">Дата создания</th>
            <th style="width: 200px;">Действия</th>
          </tr>
          </thead>
          <tbody>
          <!-- Если плейлисты есть -->
          <tr th:each="playlist, iter : ${playlists}"
              th:class="${iter.odd} ? 'odd-row' : 'even-row'">
            <td>
              <div style="width: 40px; height: 40px; border-radius: 5px; background: linear-gradient(45deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-music" style="color: white;"></i>
              </div>
            </td>
            <td>
              <a th:href="@{/playlists/{id}(id=${playlist.id})}"
                 style="color: white; text-decoration: none; font-weight: 500; font-size: 16px;">
                [[${playlist.name}]]
              </a>
              <div th:if="${playlist.description}"
                   style="color: #aaa; font-size: 12px; margin-top: 5px;">
                [[${playlist.description}]]
              </div>
            </td>
            <td style="color: #aaa;">
              <i class="fas fa-music" style="margin-right: 8px;"></i>
              [[${playlist.trackCount}]]
            </td>
            <td style="color: #aaa;">
              [[${#temporals.format(playlist.createdAt, 'dd.MM.yyyy')}]]
            </td>
            <td>
              <div class="track-actions">
                <a th:href="@{/playlists/{id}(id=${playlist.id})}"
                   class="action-btn" title="Открыть">
                  <i class="fas fa-eye"></i>
                </a>
                <a th:if="${playlist.name != 'Моя музыка'}"
                   th:href="@{/playlists/{id}/edit(id=${playlist.id})}"
                   class="action-btn" title="Редактировать">
                  <i class="fas fa-edit"></i>
                </a>
                <form th:if="${playlist.name != 'Моя музыка'}"
                      th:action="@{/playlists/{id}/delete(id=${playlist.id})}"
                      method="post"
                      style="display: inline;"
                      onsubmit="return confirm('Удалить плейлист [[${playlist.name}]]?')">
                  <button type="submit" class="action-btn" title="Удалить" style="background: none; border: none;">
                    <i class="fas fa-trash" style="color: #ff6b6b;"></i>
                  </button>
                </form>
                <span th:if="${playlist.name == 'Моя музыка'}" style="color: #aaa; font-size: 12px;" title="Этот плейлист нельзя удалить">
                  <i class="fas fa-lock"></i>
                </span>
              </div>
            </td>
          </tr>

          <!-- Если плейлистов нет -->
          <tr th:if="${#lists.isEmpty(playlists)}">
            <td colspan="5" style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; color: rgba(255,255,255,0.1); margin-bottom: 20px;">
                <i class="fas fa-list"></i>
              </div>
              <h3 style="color: #aaa; margin-bottom: 10px;">Плейлистов пока нет</h3>
              <p style="color: #666; margin-bottom: 20px;">
                Создайте свой первый плейлист и добавьте в него любимые треки
              </p>
              <a th:href="@{/playlists/new}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Создать первый плейлист
              </a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Пагинация -->
    <div th:if="${totalPages > 1}" class="section" style="padding-top: 15px;">
      <div class="pagination">
        <!-- Кнопка "Назад" -->
        <a th:href="@{/playlists(page=${currentPage > 1 ? currentPage - 1 : 1}, search=${searchQuery}, sort=${sort})}"
           th:classappend="${currentPage == 1} ? 'disabled' : ''"
           class="pagination-btn">
          <i class="fas fa-chevron-left"></i> Назад
        </a>

        <!-- Страницы -->
        <div class="pagination-pages">
          <!-- Первая страница -->
          <a th:href="@{/playlists(page=1, search=${searchQuery}, sort=${sort})}"
             th:classappend="${currentPage == 1} ? 'active' : ''"
             class="page-btn">
            1
          </a>

          <span th:if="${currentPage > 3}" class="page-dots">...</span>

          <!-- Страницы вокруг текущей -->
          <th:block th:each="i : ${#numbers.sequence(Math.max(2, currentPage - 1), Math.min(totalPages - 1, currentPage + 1))}">
            <a th:href="@{/playlists(page=${i}, search=${searchQuery}, sort=${sort})}"
               th:classappend="${currentPage == i} ? 'active' : ''"
               class="page-btn">
              [[${i}]]
            </a>
          </th:block>

          <span th:if="${currentPage < totalPages - 2}" class="page-dots">...</span>

          <!-- Последняя страница если не первая -->
          <a th:if="${totalPages > 1}"
             th:href="@{/playlists(page=${totalPages}, search=${searchQuery}, sort=${sort})}"
             th:classappend="${currentPage == totalPages} ? 'active' : ''"
             class="page-btn">
            [[${totalPages}]]
          </a>
        </div>

        <!-- Кнопка "Вперед" -->
        <a th:href="@{/playlists(page=${currentPage < totalPages ? currentPage + 1 : totalPages}, search=${searchQuery}, sort=${sort})}"
           th:classappend="${currentPage == totalPages} ? 'disabled' : ''"
           class="pagination-btn">
          Вперед <i class="fas fa-chevron-right"></i>
        </a>

        <!-- Информация о странице -->
        <div style="color: #aaa; font-size: 14px; margin-left: 20px;">
          Страница [[${currentPage}]] из [[${totalPages}]]
        </div>

        <!-- Выбор размера страницы -->
        <div class="page-size-selector">
          <span>Показывать по:</span>
          <form th:action="@{/playlists}" method="get" style="display: inline;">
            <input type="hidden" name="search" th:value="${searchQuery}">
            <input type="hidden" name="sort" th:value="${sort}">
            <select name="size" class="form-input small" onchange="this.form.submit()">
              <option value="10" th:selected="${pageSize == 10}">10</option>
              <option value="20" th:selected="${pageSize == 20}">20</option>
              <option value="50" th:selected="${pageSize == 50}">50</option>
            </select>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно для быстрого создания плейлиста -->
<div class="modal-overlay" id="create-playlist-modal" style="display: none;">
  <div class="modal">
    <h2>Создать плейлист</h2>
    <form th:action="@{/playlists}" method="post" class="modal-form">
      <input type="text" name="name" placeholder="Название плейлиста" required
             class="form-input" style="margin-bottom: 15px;">
      <textarea name="description" placeholder="Описание (необязательно)"
                class="form-input" style="height: 100px; resize: vertical;"></textarea>
      <button type="submit" class="modal-submit">Создать</button>
      <button type="button" class="modal-cancel" onclick="closeModal('create-playlist-modal')">Отмена</button>
    </form>
  </div>
</div>

<script th:inline="javascript">
  /*<![CDATA[*/
  function showCreateModal() {
      document.getElementById('create-playlist-modal').style.display = 'flex';
  }

  function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', function() {
      const createBtn = document.querySelector('.btn-primary');
      if (createBtn && createBtn.getAttribute('href') === '/playlists/new') {

      }
  });
  /*]]>*/
</script>
</body>
</html>